<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÆ∂Â∫≠ÈÜ´ÁôÇË°åÁ®ãÂàÜÂ∑•Â∞èÂ∑•ÂÖ∑</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #4a90e2;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --border-color: #d1d8e0;
            --text-main: #2d3436;
            --text-muted: #636e72;
            --success-color: #27ae60;
            --warning-color: #f39c12;
        }

        * { box-sizing: border-box; font-family: "PingFang TC", "Heiti TC", "Microsoft JhengHei", sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 15px;
            line-height: 1.5;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 15px;
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }

        header h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; }
        header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; }

        .event-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 16px;
            border-left: 8px solid var(--warning-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .event-card.assigned { border-left-color: var(--success-color); }

        .date-badge {
            display: inline-block;
            background: #edf2f7;
            color: var(--primary-color);
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 800;
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .event-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 6px;
            color: #1a1a1a;
        }

        .event-info {
            font-size: 0.95rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .hint {
            background: #fff5f5;
            color: #c0392b;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: 15px;
            border: 1px solid #fed7d7;
        }

        .control-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
        }

        .control-item label {
            display: block;
            font-size: 0.8rem;
            margin-bottom: 4px;
            font-weight: bold;
            color: var(--primary-color);
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background-color: #fff;
            outline: none;
        }

        select:focus, input:focus { border-color: var(--accent-color); }

        .action-area {
            position: sticky;
            bottom: 20px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-top: 30px;
        }

        button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-generate { background-color: var(--primary-color); color: white; margin-bottom: 8px; }
        .btn-copy { background-color: var(--success-color); color: white; display: none; }
        
        button:active { transform: scale(0.98); }

        #preview-area {
            display: none;
            background: #f1f2f6;
            border: 1px dashed #ced4da;
            padding: 12px;
            margin: 12px 0;
            border-radius: 10px;
            white-space: pre-wrap;
            font-size: 0.9rem;
            color: #2f3542;
        }

        @media (max-width: 480px) {
            .control-group { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üè• ÈÜ´ÁôÇË°åÁ®ãÂàÜÂ∑•Ë°®</h1>
        <p id="current-date"></p>
    </header>

    <div id="event-list"></div>

    <div class="action-area">
        <button class="btn-generate" onclick="generateOutput()">üìù Áî¢ÁîüÁæ§ÁµÑË≤ºÊñá</button>
        <div id="preview-area"></div>
        <button id="copy-btn" class="btn-copy" onclick="copyToClipboard()">üìã Ë§áË£ΩÊñáÂ≠óÔºàË≤ºÂà∞ LINEÔºâ</button>
    </div>
</div>

<script>
    // 1. Â∑≤ÁßªÈô§„ÄåËÄÅÂÖ¨„ÄçÁöÑ‰∫∫Âì°ÂêçÂñÆ
    const candidates = ["Êú™Ë™çÈ†ò", "Ê¥™ÊÖßÁúü", "Ê¥™ÂúãÈæç", "Ê¥™ÊÖßÁ¥î", "Ê¥™Ëä≥Ëåπ", "Ê¥™ÂúãÂ≥∞"];
    
    // 2. Ë°åÁ®ãË≥áÊñô
    const events = [
        { id: 'ev1', date: '2026-02-20', weekday: '‰∫î', time: 'Êó©‰∏ä', title: 'ÊäΩË°ÄÔºãÈ©óÂ∞ø', location: 'ÈÜ´Èô¢Ê™¢È©óÁßë', notesHint: 'Á©∫ËÖπ 8‚Äì12 Â∞èÊôÇ' },
        { id: 'ev2', date: '2026-02-21', weekday: 'ÂÖ≠', time: '‰∏äÂçà', title: 'Á•ûÁ∂ìÁßëÂõûË®∫', location: 'A131Ôºè33ËôüÔºèË©πÂºòÂª∑ÈÜ´Â∏´', notesHint: '' },
        { id: 'ev3', date: '2026-02-26', weekday: 'Âõõ', time: '08:30', title: 'Á•ûÁ∂ìÂÇ≥Â∞é NCV', location: 'Ê™¢Êü•ÂÆ§', notesHint: '' },
        { id: 'ev4', date: '2026-02-26', weekday: 'Âõõ', time: '10:00', title: 'ËÖ¶Ê≥¢ EEG', location: '2Ê®ìËÖ¶Ê≥¢ÂÆ§', notesHint: 'Ââç‰∏ÄÂ§©Ê¥óÈ†≠„ÄÅ‰∏çË¶ÅÈ´ÆÊ≤π„ÄÅÊèêÂâç10ÂàÜÈêòÂ†±Âà∞' },
        { id: 'ev5', date: '2026-03-03', weekday: '‰∫å', time: '10:00', title: 'SSEP Ê™¢Êü•', location: 'Ê™¢Êü•ÂÆ§', notesHint: '' },
        { id: 'ev6', date: '2026-03-23', weekday: '‰∏Ä', time: '15:00', title: 'Êô∫ËÉΩÊ™¢Êü• (NPI+MMSE+CDR)', location: 'Ê™¢Êü•ÂÆ§', notesHint: '' }
    ];

    // ÂàùÂßãÂåñËÆÄÂèñ
    let savedData = JSON.parse(localStorage.getItem('family_medical_v3')) || {};

    function render() {
        const list = document.getElementById('event-list');
        list.innerHTML = '';

        events.forEach(ev => {
            const state = savedData[ev.id] || { assignee: 'Êú™Ë™çÈ†ò', note: '' };
            const isAssigned = state.assignee !== 'Êú™Ë™çÈ†ò';
            
            const card = document.createElement('div');
            card.className = `event-card ${isAssigned ? 'assigned' : ''}`;
            
            card.innerHTML = `
                <div class="date-badge">${ev.date} (${ev.weekday}) ${ev.time}</div>
                <div class="event-title">${ev.title}</div>
                <div class="event-info">üìç Âú∞ÈªûÔºö${ev.location}</div>
                ${ev.notesHint ? `<div class="hint">‚ö†Ô∏è Ê≥®ÊÑèÔºö${ev.notesHint}</div>` : ''}
                
                <div class="control-group">
                    <div class="control-item">
                        <label>Ë≤†Ë≤¨‰∫∫</label>
                        <select onchange="save('${ev.id}', 'assignee', this.value)">
                            ${candidates.map(c => `<option value="${c}" ${state.assignee === c ? 'selected' : ''}>${c}</option>`).join('')}
                        </select>
                    </div>
                    <div class="control-item">
                        <label>ÂÇôË®ª</label>
                        <input type="text" placeholder="Ë£úÂÖÖË™™Êòé..." value="${state.note}" 
                               oninput="save('${ev.id}', 'note', this.value)">
                    </div>
                </div>
            `;
            list.appendChild(card);
        });
    }

    function save(id, field, value) {
        if (!savedData[id]) savedData[id] = { assignee: 'Êú™Ë™çÈ†ò', note: '' };
        savedData[id][field] = value;
        localStorage.setItem('family_medical_v3', JSON.stringify(savedData));
        if (field === 'assignee') render();
    }

    function generateOutput() {
        let text = `„Äêüè• Â∞±ÈÜ´Ë°åÁ®ãÂàÜÂ∑•ÊèêÈÜí„Äë\n\n`;
        
        events.forEach((ev, index) => {
            const data = savedData[ev.id] || { assignee: 'Êú™Ë™çÈ†ò', note: '' };
            const person = data.assignee === 'Êú™Ë™çÈ†ò' ? 'ÔºàÂæÖË™çÈ†òÔºâ' : data.assignee;
            
            text += `${index + 1}. ${ev.date} (${ev.weekday}) ${ev.time}\n`;
            text += `   üî∏ È†ÖÁõÆÔºö${ev.title}\n`;
            text += `   üôã Ë≤†Ë≤¨Ôºö${person}\n`;
            
            let combined = [];
            if (ev.notesHint) combined.push(ev.notesHint);
            if (data.note) combined.push(data.note);
            if (combined.length > 0) text += `   üìù ÂÇôË®ªÔºö${combined.join('„ÄÅ')}\n`;
            text += `\n`;
        });

        text += `ËÉΩÂçîÂä©ËÄÖË´ãÂõûË¶ÜÔºåÊàëÂÜçÊõ¥Êñ∞Ë°®Ê†ºÔºåË¨ùË¨ùÂ§ßÂÆ∂ÔºÅ\n`;
        text += `(Êõ¥Êñ∞Êó•ÊúüÔºö${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})})`;

        const preview = document.getElementById('preview-area');
        preview.innerText = text;
        preview.style.display = 'block';
        document.getElementById('copy-btn').style.display = 'flex';
        preview.scrollIntoView({ behavior: 'smooth' });
    }

    function copyToClipboard() {
        const text = document.getElementById('preview-area').innerText;
        navigator.clipboard.writeText(text).then(() => {
            const btn = document.getElementById('copy-btn');
            btn.innerHTML = '‚úÖ Â∑≤Ë§áË£ΩÔºÅÂèØÁõ¥Êé•Ë≤ºÂà∞ LINE';
            setTimeout(() => { btn.innerHTML = 'üìã Ë§áË£ΩÊñáÂ≠óÔºàË≤ºÂà∞ LINEÔºâ'; }, 2000);
        });
    }

    document.getElementById('current-date').innerText = `‰ªäÂ§©Êó•ÊúüÔºö${new Date().toLocaleDateString('zh-TW')}`;
    render();
</script>

</body>
</html>